(this["webpackJsonpstardog-react-kepler"]=this["webpackJsonpstardog-react-kepler"]||[]).push([[0],{1301:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n(90),i=n.n(o),r=n(12),s=n(767),c=n.n(s),d=n(520),u={REACT_APP_MAPBOX_TOKEN:Object({NODE_ENV:"production",PUBLIC_URL:"/stardog-react-kepler",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_MAPBOX_TOKEN},p="PREFIX wd: <http://www.wikidata.org/entity/>\nPREFIX wdt: <http://www.wikidata.org/prop/direct/>\nPREFIX p: <http://www.wikidata.org/prop/>\nPREFIX ps: <http://www.wikidata.org/prop/statement/>\nPREFIX psv: <http://www.wikidata.org/prop/statement/value/>\nPREFIX wikibase: <http://wikiba.se/ontology#>\n\nSELECT ?".concat(["countyName","cases","population","percentCases","lat","lng"].join(" ?"),"\n{\n    # get the latest date\n    { SELECT (max(?d) as ?date) { ?r :date ?d } }\n\n    # get all the reports for the latest date\n    ?report\n        :cases ?cases  ;\n        :date ?date ;                \n        :county [\n            rdfs:label ?countyName ;\n            :fips ?fips\n        ]    \n\n    # Get coordinates of\n    SERVICE <https://query.wikidata.org/sparql> \n    {\n        SELECT * {\n            ?item wdt:P882 ?fips ;\n                  wdt:P1082 ?population ;\n                  p:P625 ?coordPoint .\n            ?coordPoint psv:P625 ?coord_node .\n            ?coord_node wikibase:geoLongitude ?lng ;\n                        wikibase:geoLatitude ?lat .\n        }\n    }   \n    # compute percentages\n    BIND(roundHalfToEven((?cases / ?population) * 100, 2) AS ?percentCases)\n}\nORDER BY desc(?percentCases)"),l=n(188),f=n(368),O="CovidCasesDataUpdate",b=n(8),j=n.n(b),w=n(19),m=n(391),g=n(93),h=Object(a.createContext)({connection:{}}),v=function(e){var t=e.username,n=e.password,a=e.endpoint,o=e.children,i=new m.Connection({username:t,password:n,endpoint:a});return Object(g.jsx)(h.Provider,{value:{connection:i},children:o})},E=function(){var e=Object(l.useSelector)((function(e){return e})).covidCasesData,t=Object(l.useDispatch)(),n=function(){var e=Object(a.useContext)(h).connection,t=Object(a.useState)(!1),n=Object(r.a)(t,2),o=n[0],i=n[1],s=Object(a.useState)(),c=Object(r.a)(s,2),d=c[0],u=c[1],p=Object(a.useState)(null),l=Object(r.a)(p,2),f=l[0],O=l[1];return[Object(a.useCallback)(function(){var t=Object(w.a)(j.a.mark((function t(n){var a,o,r,s;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.readQuery,o=n.dbName,i(!0),t.next=4,m.query.execute(e,o,a);case 4:if((r=t.sent).ok){t.next=9;break}return u({status:r.status,statusText:r.statusText}),i(!1),t.abrupt("return");case 9:s=r.body.results.bindings,O(s),i(!1);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e]),{error:d,loading:o,data:f}]}(),o=Object(r.a)(n,2),i=o[0],s=o[1],b=s.data,v=s.loading,E=s.error;return Object(a.useEffect)((function(){e.length||i({dbName:"covid19nyt",readQuery:p})}),[t,e,i]),Object(a.useEffect)((function(){if(null===b||void 0===b?void 0:b.length){t({type:O,covidCases:b});var e={fields:[{name:"cases",format:"",type:"integer"},{name:"lng",format:"",type:"real"},{name:"percentCases",format:"",type:"real"},{name:"lat",format:"",type:"real"},{name:"countyName",format:"",type:"string"},{name:"population",format:"",type:"integer"}],rows:b.map((function(e){return Object.keys(e).map((function(t){return"countyName"===t?e[t].value:Number(e[t].value)}))}))};t(Object(d.addDataToMap)({datasets:{info:{label:"Counties with most cases per capita",id:"covid_cases"},data:e},options:{keepExistingConfig:!0},config:{visState:{layers:[{id:"wtp9fb",type:"heatmap",config:{dataId:"covid_cases",label:"Covid Cases Heatmap",color:[248,149,112],columns:{lat:"lat",lng:"lng"},isVisible:!0,visConfig:{opacity:.8,radius:97.4},hidden:!1},visualChannels:{weightField:{name:"percentCases",type:"real"},weightScale:"linear"}}]}}})),t(Object(d.updateMap)({latitude:39.738756,longitude:-105.023357,zoom:4}))}}),[t,b]),E?Object(g.jsxs)("div",{children:["Error! ",JSON.stringify(E)]}):Object(g.jsxs)(g.Fragment,{children:[v&&Object(g.jsx)("div",{children:"Fancy loading screen..."}),Object(g.jsx)("div",{style:{width:"100%",height:"100%",position:"absolute",left:0,top:0,visibility:v?"hidden":"unset"},children:Object(g.jsx)(f.AutoSizer,{children:function(e){var t=e.height,n=e.width;return Object(g.jsx)(c.a,{id:"map",mapboxApiAccessToken:u.REACT_APP_MAPBOX_TOKEN,width:n,height:t})}})})]})},y=n(205),C=n(140),_=n(791),k=n.n(_),x=Object(C.combineReducers)({keplerGl:k.a,covidCasesData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:return t.covidCases;default:return e}}}),P=function(e){var t=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||C.compose;return Object(C.createStore)(x,e,t(Object(C.applyMiddleware)(y.taskMiddleware)))}(),S=function(){return Object(g.jsx)(l.Provider,{store:P,children:Object(g.jsx)(v,{username:"anonymous",password:"anonymous",endpoint:"https://express.stardog.cloud:5820",children:Object(g.jsx)(E,{})})})};i.a.render(Object(g.jsx)(S,{}),document.getElementById("root"))},301:function(e,t){},302:function(e,t){},304:function(e,t){},511:function(e,t){},512:function(e,t){},513:function(e,t){},514:function(e,t){},515:function(e,t){},516:function(e,t){},517:function(e,t){},551:function(e,t){},552:function(e,t){},553:function(e,t){},774:function(e,t){},775:function(e,t){},776:function(e,t){},777:function(e,t){},920:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=920},924:function(e,t){},958:function(e,t,n){var a={"./":38,"./ca":589,"./ca.js":589,"./en":425,"./en.js":425,"./es":590,"./es.js":590,"./fi":591,"./fi.js":591,"./formatted-message":426,"./formatted-message.js":426,"./index":38,"./index.js":38,"./locales":145,"./locales.js":145,"./pt":592,"./pt.js":592};function o(e){var t=i(e);return n(t)}function i(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}o.keys=function(){return Object.keys(a)},o.resolve=i,e.exports=o,o.id=958},978:function(e,t){}},[[1301,1,2]]]);
//# sourceMappingURL=main.c611beed.chunk.js.map